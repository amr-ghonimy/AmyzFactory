
@model List<AmyzFactory.Models.ProductViewModel>

@{
    Layout = "~/Views/Shared/_Layout.cshtml";

    float shippingCost = 30.5f;
    int counter = 0;
 }

 

   <!-- Start Cart  -->
<div class="cart-box-main">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <div class="table-main table-responsive">
                    <table id="tbl" class="table" style="text-align:center;">
                        <thead>
                            <tr style="text-align:center;">
                                <th>الصورة</th>
                                <th>اسم المنتج</th>
                                <th>السعر</th>
                                <th>الكمية</th>
                                <th>الاجمالى</th>
                                <th>حذف</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="thumbnail-img">
                                    <a href="#">
                                        <img class="img-fluid" src="~/Content/img/img-pro-01.jpg" alt="" />
                                    </a>
                                </td>
                                <td class="name-pr">
                                    <a href="#">
                                        Lorem ipsum dolor sit amet
                                    </a>
                                </td>
                                <td class="price-pr">
                                    <p>$ 80.0</p>
                                </td>
                                <td class="quantity-box"><input type="number" size="4" value="1" min="0" step="1" class="c-input-text qty text"></td>
                                <td class="total-pr">
                                    <p>$ 80.0</p>
                                </td>
                                <td class="remove-pr">
                                    <a href="#">
                                        <i class="fas fa-times"></i>
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td class="thumbnail-img">
                                    <a href="#">
                                        <img class="img-fluid" src="~/Content/img/img-pro-02.jpg" alt="" />
                                    </a>
                                </td>
                                <td class="name-pr">
                                    <a href="#">
                                        Lorem ipsum dolor sit amet
                                    </a>
                                </td>
                                <td class="price-pr">
                                    <p>$ 60.0</p>
                                </td>
                                <td class="quantity-box"><input type="number" size="4" value="1" min="0" step="1" class="c-input-text qty text"></td>
                                <td class="total-pr">
                                    <p>$ 80.0</p>
                                </td>
                                <td class="remove-pr">
                                    <a href="#">
                                        <i class="fas fa-times"></i>
                                    </a>
                                </td>
                            </tr>
                            <tr>
                                <td class="thumbnail-img">
                                    <a href="#">
                                        <img class="img-fluid" src="~/Content/img/img-pro-03.jpg" alt="" />
                                    </a>
                                </td>
                                <td class="name-pr">
                                    <a href="#">
                                        Lorem ipsum dolor sit amet
                                    </a>
                                </td>
                                <td class="price-pr">
                                    <p>$ 30.0</p>
                                </td>
                                <td class="quantity-box"><input type="number" size="4" value="1" min="0" step="1" class="c-input-text qty text"></td>
                                <td class="total-pr">
                                    <p>$ 80.0</p>
                                </td>
                                <td class="remove-pr">
                                    <a href="#">
                                        <i class="fas fa-times"></i>
                                    </a>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

       
        <div class="row my-5">
            <div class="col-lg-8 col-sm-12"></div>
            <div class="col-lg-4 col-sm-12">
                <div class="order-box">
                    <h2 class="footer-title">تفاصيل الطلب</h2>
                    <div class="d-flex">
                        <h4 class="footer-text">السعر الجزئى</h4>
                        <div class="ml-auto font-weight-bold">&nbsp; $ 40 </div>
                    </div>
                    <div class="d-flex">
                        <h4 class="footer-text">الخصم</h4>
                        <div class="ml-auto font-weight-bold">&nbsp; $ 40 </div>
                    </div>
                    <hr class="my-1">
                     
                    <div class="d-flex">
                        <h4 class="footer-text">الضريبة</h4>
                        <div class="ml-auto font-weight-bold">&nbsp; $ 2 </div>
                    </div>
                    <div class="d-flex">
                        <h4 class="footer-text">مصاريف الشحن</h4>
                        <div class="ml-auto font-weight-bold">&nbsp; Free </div>
                    </div>
                    <hr>
                    <div class="d-flex gr-total">
                        <h5 class="footer-text">الاجمالى</h5>
                        <div class="ml-auto h5">&nbsp; $ 388 </div>
                    </div>
                    <hr>
                </div>
            </div>
            <div class="col-12 d-flex shopping-box"><a href="checkout.html" class="ml-auto btn hvr-hover">متابعه الطلب</a> </div>
        </div>

    </div>
</div>
<!-- End Cart -->













<script src="~/Areas/Admin/Content/js/jquery-2.1.1.js"></script>
<script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
<script src="~/Areas/Admin/Content/js/dialogs.js"></script>

<script>

    $(function () {
        $(document).ajaxError(function (e, xhr) {
            if (xhr.status == 403) {
                var response = $.parseJSON(xhr.responseText);
                window.location = response.LogOnUrl;
            }
        });
    });

    var list = @Html.Raw(Json.Encode(Model));
   
    $(document).ready(function () {
        $('#emptyContainer').hide();

        if(list!==null){
            updateInvoice();
        }
    });

    $('#tbl').on('change', 'input', function () {
        var totalID = $(this).attr("total-id")
        var qty = $(this).val();
        var price = $(this).attr("item-price")
        var itemPosition = $(this).attr("item-position")

        var totalValue = qty * price;
        list[itemPosition].Total = totalValue;
        list[itemPosition].Quantity=qty;
        $("#" + totalID).text(totalValue.toFixed(2).toString());
        updateInvoice();
    });

    function updateInvoice() {
        debugger;
        var total = 0.0;
        var shippingCost=$('#shippingValue').attr("shipping-cost");
        
        list.forEach(function (item) {
            total=total+item.Total;
        });

        total= parseFloat(total)+parseFloat(shippingCost);
        total=parseFloat(total).toFixed(2);
        $('#invoicePrice').text(total);
    }

    function deleteRow(itemID) {

        var URL = "/Order/Delete?itemID=" + itemID;
        var rawID = "tr" + itemID;

        $.ajax({
            url: URL,
            type: "Get",
            dataType: "json",
            success: function (data) {
                if (data.IsSuccess) {
                    $('#counterText').text(data.Message);
                  
                   // delete list[itemPosition];
                //    list.splice(itemPosition-1,1);

                    for (var i = 0; i < list.length; i++) {
                        var obj = list[i];
                        if(obj.Id===itemID){
                            list.splice(i, 1);
                        }
                      
                    }


                    $('#' + rawID).remove();

                    debugger;
                    if(list.length ===0){
                        $('#sectionContainer').remove();
                        $('#emptyContainer').show();
                    }else {
                        updateInvoice();
                    }

                }
            }
        });

 
    }


    function continueOrder() {


        var finalList = new Array();


        $.each(list, function (index, element) {
            debugger;

            var ProductViewModel = {};
            if (element != null) {
                ProductViewModel.Id = element.Id;
                ProductViewModel.Price = element.Price;
                ProductViewModel.Quantity = element.Quantity;
                ProductViewModel.Total = element.Total;
                finalList.push(ProductViewModel);
            }
        });


         


        var dataJson = JSON.stringify(finalList);

        $.ajax({
            async: true,
            type: "POST",
            url: "/Order/ContinueOrder",
            data: dataJson,
            success: function (response) {
                window.location.href =response ;
            },
            dataType: "json",
            contentType: 'application/json; charset=utf=8',
            traditional: true
        });

    }

   
</script>
